# ব্যালট ও এলাকা মুছে ফেলার ফিচার (শুধুমাত্র সুপার অ্যাডমিনের জন্য)

## বৈশিষ্ট্য

এই ফিচারটি **শুধুমাত্র সুপার অ্যাডমিনদের** ব্যালট ও এলাকা মুছে ফেলার সুবিধা দেয়। যখন সুপার অ্যাডমিন কোনো ব্যালট/এলাকা মুছে ফেলবেন, তখন সেটি **সকল অ্যাডমিনের জন্য স্বয়ংক্রিয়ভাবে মুছে যাবে**।

---

## অনুমতি (Permissions)

| ভূমিকা | ব্যালট যোগ করা | ব্যালট মুছে ফেলা | ব্যালট তালিকা দেখা |
|--------|---------------|------------------|-------------------|
| **সুপার অ্যাডমিন** | ✅ হ্যাঁ | ✅ হ্যাঁ | ✅ হ্যাঁ |
| **নরমাল অ্যাডমিন** | ✅ হ্যাঁ | ❌ না | ❌ না |

---

## কিভাবে কাজ করে

### সুপার অ্যাডমিনের ড্যাশবোর্ড:

1. **ব্যালট তৈরি সেকশনে** একটি নতুন সেকশন দেখাবে: **"বিদ্যমান ব্যালট ও এলাকা ব্যবস্থাপনা"**
   - এই সেকশন শুধুমাত্র সুপার অ্যাডমিনের জন্য দৃশ্যমান
   - নরমাল অ্যাডমিনরা এটি দেখতে পাবে না

2. **ব্যালট তালিকা টেবিল:**
   - সকল ব্যালট নাম ও তাদের এলাকা দেখাবে
   - প্রতিটি ব্যালটের জন্য তৈরির তারিখ এবং কে তৈরি করেছে দেখাবে
   - একই নাম বিশিষ্ট ব্যালটগুলো একসাথে গ্রুপ করা থাকবে
   - প্রতিটি এলাকার জন্য আলাদা আলাদা "মুছুন" বাটন থাকবে

3. **ব্যালট মুছে ফেলা:**
   - "মুছুন" বাটনে ক্লিক করলে একটি কনফার্মেশন ডায়ালগ আসবে
   - কনফার্ম করলে ব্যালটটি ডাটাবেস থেকে মুছে যাবে
   - সকল অ্যাডমিনের ড্রপডাউন থেকে স্বয়ংক্রিয়ভাবে সরে যাবে

---

## টেকনিক্যাল বিবরণ

### Backend API:

#### DELETE `/api/admin/ballots/:id`
- **অনুমতি:** শুধুমাত্র সুপার অ্যাডমিন (`authenticateSuperAdmin` middleware)
- **কাজ:** নির্দিষ্ট ID এর ব্যালট ডাটাবেস থেকে মুছে ফেলে
- **Response:**
  ```json
  {
    "success": true,
    "message": "ব্যালট সফলভাবে মুছে ফেলা হয়েছে এবং সকল অ্যাডমিনের জন্য সরানো হয়েছে"
  }
  ```

#### GET `/api/admin/ballots`
- **অনুমতি:** সকল অ্যাডমিন
- **কাজ:** সকল ব্যালটের তালিকা রিটার্ন করে (সুপার অ্যাডমিনের জন্য তালিকা দেখানোর জন্য)
- **Response:**
  ```json
  {
    "success": true,
    "ballots": [
      {
        "_id": "...",
        "name": "জাতীয় সংসদ নির্বাচন -২০২৬",
        "location": "ঢাকা-৮",
        "createdBy": {
          "_id": "...",
          "username": "admin"
        },
        "createdAt": "2026-02-03T10:30:00.000Z"
      }
    ]
  }
  ```

### Frontend:

#### 1. **`loadExistingBallots()`**
   - সুপার অ্যাডমিন চেক করে
   - যদি সুপার অ্যাডমিন হয়, তাহলে ব্যালট তালিকা API থেকে fetch করে
   - `displayBallotsList()` কল করে তালিকা প্রদর্শন করে
   - নরমাল অ্যাডমিনের জন্য সেকশন লুকিয়ে রাখে

#### 2. **`displayBallotsList(ballots)`**
   - ব্যালটগুলোকে নাম অনুযায়ী গ্রুপ করে
   - HTML টেবিল তৈরি করে
   - প্রতিটি এলাকার জন্য "মুছুন" বাটন যুক্ত করে
   - একই নামের ব্যালটগুলোর জন্য rowspan ব্যবহার করে

#### 3. **`deleteBallot(ballotId, ballotName, ballotLocation)`**
   - কনফার্মেশন ডায়ালগ দেখায়
   - DELETE API কল করে
   - সফল হলে:
     - সাকসেস মেসেজ দেখায়
     - ব্যালট তালিকা রিলোড করে
     - ড্রপডাউন অপশন রিলোড করে

---

## UI স্ক্রিনশট বর্ণনা

### সুপার অ্যাডমিন দেখবে:

```
┌─────────────────────────────────────────────────────────────┐
│ নতুন ব্যালটের নাম ও এলাকা যোগ করুন                        │
├─────────────────────────────────────────────────────────────┤
│ [ব্যালটের নাম]  [এলাকা]  [+ যোগ করুন]                    │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ বিদ্যমান ব্যালট ও এলাকা ব্যবস্থাপনা (শুধুমাত্র সুপার অ্যাডমিন) │
├─────────────────────────────────────────────────────────────┤
│ আপনি যেকোনো ব্যালট/এলাকা মুছে ফেললে সকল অ্যাডমিনের জন্য তা মুছে যাবে │
├──────────────────┬──────────┬────────────┬──────────┬──────┤
│ ব্যালটের নাম    │ এলাকা    │ তারিখ      │ তৈরি করেছে │ পদক্ষেপ │
├──────────────────┼──────────┼────────────┼──────────┼──────┤
│ জাতীয় সংসদ     │ ঢাকা-৭   │ ০৩/০২/২০২৬│ admin    │[মুছুন]│
│ নির্বাচন -২০২৬  │ ঢাকা-৮   │ ০৩/০২/২০২৬│ admin    │[মুছুন]│
│                  │ ঢাকা-৯   │ ০৩/০২/২০২৬│ admin2   │[মুছুন]│
├──────────────────┼──────────┼────────────┼──────────┼──────┤
│ জাতীয় সংসদ     │ ঢাকা-১০  │ ০২/০২/২০২৬│ admin    │[মুছুন]│
│ নির্বাচন -২০২৫  │ চট্টগ্রাম-১│০২/০২/২০২৬│ admin    │[মুছুন]│
└──────────────────┴──────────┴────────────┴──────────┴──────┘
```

### নরমাল অ্যাডমিন দেখবে:

```
┌─────────────────────────────────────────────────────────────┐
│ নতুন ব্যালটের নাম ও এলাকা যোগ করুন                        │
├─────────────────────────────────────────────────────────────┤
│ [ব্যালটের নাম]  [এলাকা]  [+ যোগ করুন]                    │
└─────────────────────────────────────────────────────────────┘

(ব্যালট ব্যবস্থাপনা সেকশন দেখাবে না)
```

---

## ব্যবহারের উদাহরণ

### স্টেপ ১: সুপার অ্যাডমিন হিসেবে লগইন করুন

### স্টেপ ২: "ব্যালট তৈরি" সেকশনে যান

### স্টেপ ৩: "বিদ্যমান ব্যালট ও এলাকা ব্যবস্থাপনা" টেবিল দেখুন

### স্টেপ ৪: যে ব্যালট/এলাকা মুছতে চান তার "মুছুন" বাটনে ক্লিক করুন

### স্টেপ ৫: কনফার্মেশন ডায়ালগে "OK" ক্লিক করুন

```
আপনি কি নিশ্চিত যে "জাতীয় সংসদ নির্বাচন -২০২৬ - ঢাকা-৮" মুছে ফেলতে চান?

সতর্কতা: এটি সকল অ্যাডমিনের জন্য মুছে যাবে।

[Cancel] [OK]
```

### স্টেপ ৬: সফল মেসেজ দেখুন এবং টেবিল স্বয়ংক্রিয়ভাবে আপডেট হবে

---

## নিরাপত্তা বৈশিষ্ট্য

1. **অনুমোদন যাচাই:**
   - Backend এ `authenticateSuperAdmin` middleware দিয়ে নিশ্চিত করা হয় শুধু সুপার অ্যাডমিনই মুছতে পারবে
   - JWT Token verification করা হয়
   - Role check করা হয়

2. **ডাবল কনফার্মেশন:**
   - মুছার আগে কনফার্মেশন ডায়ালগ দেখানো হয়
   - স্পষ্টভাবে বলা হয় যে সকল অ্যাডমিনের জন্য মুছে যাবে

3. **স্বয়ংক্রিয় রিলোড:**
   - মুছার পর তালিকা এবং ড্রপডাউন স্বয়ংক্রিয়ভাবে আপডেট হয়
   - Database থেকে মুছে যায়, তাই সকল অ্যাডমিনের জন্য প্রভাব পড়ে

---

## ফাইল পরিবর্তন সারাংশ

### 1. **Backend:** `/server/routes/admin.js`
   - ✅ `DELETE /api/admin/ballots/:id` route আপডেট করা হয়েছে
   - ✅ `authenticateAdmin` থেকে `authenticateSuperAdmin` এ পরিবর্তন করা হয়েছে
   - ✅ সাকসেস মেসেজ আপডেট করা হয়েছে

### 2. **Frontend:** `/assets/js/admin.js`
   - ✅ `loadExistingBallots()` ফাংশন যুক্ত করা হয়েছে
   - ✅ `displayBallotsList()` ফাংশন যুক্ত করা হয়েছে
   - ✅ `deleteBallot()` ফাংশন যুক্ত করা হয়েছে
   - ✅ `initializeDashboard()` এ `loadExistingBallots()` কল যুক্ত করা হয়েছে
   - ✅ `addNewBallotOption()` এ `loadExistingBallots()` কল যুক্ত করা হয়েছে

### 3. **HTML:** `/admin-dashboard.html`
   - ✅ নতুন সেকশন "বিদ্যমান ব্যালট ও এলাকা ব্যবস্থাপনা" যুক্ত করা হয়েছে
   - ✅ `manageBallotSection` div যুক্ত করা হয়েছে (initially hidden)
   - ✅ `ballotListContainer` div যুক্ত করা হয়েছে

---

## পরীক্ষা করার নির্দেশনা

### সুপার অ্যাডমিন টেস্ট:
1. সুপার অ্যাডমিন হিসেবে লগইন করুন
2. ব্যালট তৈরি সেকশনে যান
3. "বিদ্যমান ব্যালট ও এলাকা ব্যবস্থাপনা" সেকশন দেখতে পাওয়া উচিত
4. টেবিলে সকল ব্যালট দেখতে পাওয়া উচিত
5. একটি ব্যালট মুছুন
6. কনফার্ম করুন
7. সাকসেস মেসেজ দেখতে পাওয়া উচিত
8. টেবিল এবং ড্রপডাউন আপডেট হওয়া উচিত

### নরমাল অ্যাডমিন টেস্ট:
1. নরমাল অ্যাডমিন হিসেবে লগইন করুন
2. ব্যালট তৈরি সেকশনে যান
3. "বিদ্যমান ব্যালট ও এলাকা ব্যবস্থাপনা" সেকশন দেখা উচিত নয়
4. শুধু "নতুন ব্যালটের নাম ও এলাকা যোগ করুন" সেকশন দেখা উচিত
5. নতুন ব্যালট যোগ করতে পারা উচিত

### Cross-Admin টেস্ট:
1. সুপার অ্যাডমিন একটি ব্যালট মুছুন
2. নরমাল অ্যাডমিন লগইন করুন
3. সেই ব্যালট ড্রপডাউনে থাকা উচিত নয়

---

## সতর্কতা ⚠️

1. **স্থায়ী মুছে ফেলা:** ব্যালট মুছলে তা স্থায়ীভাবে ডাটাবেস থেকে মুছে যাবে
2. **সকল অ্যাডমিনের জন্য:** মুছে ফেললে সকল অ্যাডমিন (সুপার + নরমাল) তা আর দেখতে পাবে না
3. **কনফার্মেশন গুরুত্বপূর্ণ:** সবসময় কনফার্মেশন ডায়ালগ ভালো করে পড়ুন

---

## সম্পর্কিত ডকুমেন্টেশন

- [BALLOT_AREA_FEATURE.md](BALLOT_AREA_FEATURE.md) - ব্যালট নাম ও এলাকা যোগ করার ফিচার
